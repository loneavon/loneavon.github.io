<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> LogService Fluentd 部署文档 · LevinCode</title><meta name="description" content="LogService Fluentd 部署文档 - Levin Lee"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div id="mask" style="display: none;"><img id="mask-image" src="#" style=" "></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">TAGS</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">LogService Fluentd 部署文档</h1><div class="post-time">Sep 8, 2016</div><div class="post-content">


<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">&#x5B89;&#x88C5; LogService Fluentd</h2>
<div class="outline-text-2" id="text-1">
<p>
&#x76EE;&#x524D; LogService Fluentd &#x5728;&#x539F;&#x6709;&#x57FA;&#x7840;&#x4E0A;&#x5C01;&#x88C5;&#x4E86; LogService &#x7684;&#x63D2;&#x4EF6;&#xFF0C;&#x5E73;&#x53F0;&#x63D0;&#x4F9B; tar &#x5305;&#x7684;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF0C;&#x5177;&#x4F53;&#x65B9;&#x5F0F;&#x89C1;&#x4E0B;:
</p>
</div>
<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">&#x4E0B;&#x8F7D;</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">wget http://kmr-sh-hdp.ks3-cn-shanghai.ksyun.com/KSCLogService/fluentd.tar.gz -O /opt/fluentd.tar.gz</span><br></pre></td></tr></table></figure>
</div>
<p>
&#x6CE8;: &#x56E0; fluentd &#x4E2D;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x4F7F;&#x7528;&#x8DEF;&#x5F84;&#x5747;&#x4E3A; /opt, &#x6545; fluentd &#x9700;&#x90E8;&#x7F72;&#x5728; /opt &#x76EE;&#x5F55;&#x4E0B;
</p>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">&#x89E3;&#x538B;</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">cd /opt &amp;&amp; tar zxvf fluentd.tar.gz</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">&#x914D;&#x7F6E;&#x8BF4;&#x660E;</h2>
<div class="outline-text-2" id="text-2">
<p>
&#x6309;&#x7167;&#x4E0A;&#x8FF0;&#x5B89;&#x88C5;&#x6B65;&#x9AA4;&#xFF0C; Fluentd &#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x90E8;&#x7F72;&#x8DEF;&#x5F84;&#x4E3A; /opt/td-agent/etc/fluentd/fluent.conf
</p>
</div>
<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Fluentd &#x914D;&#x7F6E;&#x8BF4;&#x660E;</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Fluentd &#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x914D;&#x7F6E;&#x5B57;&#x6BB5;&#xFF1A;
</p>
<p class="verse">
<b>source</b> &#x8BBE;&#x7F6E;&#x6570;&#x636E;&#x6E90;<br>
<b>match</b> &#x8BBE;&#x7F6E;&#x8F93;&#x51FA;<br>
<b>filter</b> &#x8BBE;&#x7F6E;&#x8F93;&#x51FA;&#x524D;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;<br>
<b>system</b> &#x8BBE;&#x7F6E;&#x7CFB;&#x7EDF;&#x7EA7;&#x522B;&#x914D;&#x7F6E;<br>
<b>label</b><br>
<b>@include</b> &#x5305;&#x542B;&#x5176;&#x4ED6;&#x53EF;&#x91CD;&#x7528;&#x6587;&#x4EF6;<br>
</p>
<p>
&#x5229;&#x7528; <b>source</b> &#x548C; <b>match</b> &#x5373;&#x53EF;&#x914D;&#x7F6E;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x672C;&#x6587;&#x6863;&#x7740;&#x91CD;&#x8FD9;&#x4E24;&#x4E2A;&#x6807;&#x7B7E;
</p>
</div>
<div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1"><b>source</b> &#x6570;&#x636E;&#x4ECE;&#x54EA;&#x6765;</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
<b>source</b> &#x914D;&#x7F6E;&#x9879;&#x89C1;&#x4E0B;:
</p>
</div>
<ul class="org-ul"><li><a id="sec-2-1-1-1" name="sec-2-1-1-1"></a><b>@type</b> &#x8BBE;&#x7F6E;&#x8F93;&#x5165;&#x6E90;&#x4F7F;&#x7528;&#x7684; plugin<br><div class="outline-text-5" id="text-2-1-1-1">
<p>
input plugin @type &#x652F;&#x6301; <i>http</i> &#x548C; <i>forward</i> &#x7B49;. <i>http</i> &#x7528;&#x4E8E;&#x63A5;&#x6536; HTTP &#x534F;&#x8BAE;&#x6570;&#x636E;, <i>forward</i>  &#x7528;&#x4E8E;&#x63A5;&#x6536; TCP &#x534F;&#x8BAE;&#x6570;&#x636E;&#xFF0C;&#x5177;&#x4F53;&#x914D;&#x7F6E;&#x89C1;&#x4E0B;:
</p>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line"># Receive events from 24224/tcp
# This is used by log forwarding and the fluent-cat command
&lt;source&gt;
  @type forward
  port 24224
&lt;/source&gt;

# http://this.host:9880/myapp.access?json={&quot;event&quot;:&quot;data&quot;}
&lt;source&gt;
  @type http
  port 9880
&lt;/source&gt;</span><br></pre></td></tr></table></figure>
</div>
</div>
<ul class="org-ul"><li><a id="sec-2-1-1-1-0-1" name="sec-2-1-1-1-0-1"></a>Fluentd &#x652F;&#x6301;&#x540C;&#x65F6;&#x914D;&#x7F6E;&#x591A;&#x4E2A;&#x8F93;&#x5165;&#x6E90;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x6C42;&#x914D;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x8F93;&#x5165; type<br></li>
<li><a id="sec-2-1-1-1-0-2" name="sec-2-1-1-1-0-2"></a>&#x6BCF;&#x4E00;&#x4E2A;&#x8F93;&#x5165;&#x6E90;&#x5FC5;&#x987B;&#x6307;&#x660E;&#x8F93;&#x5165; type&#xFF0C;@type &#x914D;&#x7F6E;&#x9879;&#x8BBE;&#x5B9A;&#x4E86;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x7684; plugin&#xFF0C;&#x9664; <i>http</i> &#x548C; <i>forward</i> &#x5916;&#xFF0C;&#x5176;&#x4ED6;&#x8FD8;&#x7ECF;&#x5E38;&#x7528;&#x7684; input plugin &#x6709; tail&#x3001;syslog&#x3001;scribe&#xFF0C;&#x5168;&#x90E8; input plugin &#x4EE5;&#x53CA;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x8BF7;&#x53C2;&#x89C1;&#xFF1A;<a href="http://docs.fluentd.org/articles/input-plugin-overview" target="_blank" rel="external">Input Plugin Overview</a><br></li></ul>
</li>

<li><a id="sec-2-1-1-2" name="sec-2-1-1-2"></a><b>tag</b> &#x8BBE;&#x7F6E;&#x4E8B;&#x4EF6;&#x7684;&#x6807;&#x7B7E;<br><div class="outline-text-5" id="text-2-1-1-2">
<p>
&#x5728;&#x8BBE;&#x7F6E;&#x8F93;&#x5165;&#x6E90;&#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x540E;&#x7EED; output plugin &#x80FD;&#x591F;&#x8BC6;&#x522B;&#x8981;&#x5904;&#x7406;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x9700;&#x8BBE;&#x7F6E; <i>tag</i> &#x5B57;&#x6BB5;, &#x5177;&#x4F53;&#x89C1; match &#x90E8;&#x5206;
</p>
</div>
</li></ul>
</div>
<div id="outline-container-sec-2-1-2" class="outline-4">
<h4 id="sec-2-1-2"><b>match</b> &#x6570;&#x636E;&#x5230;&#x54EA;&#x53BB;</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
<b>match</b> &#x914D;&#x7F6E;&#x9879;&#x89C1;&#x4E0B;:
</p>
</div>
<ul class="org-ul"><li><a id="sec-2-1-2-1" name="sec-2-1-2-1"></a><b>match pattern</b><br><div class="outline-text-5" id="text-2-1-2-1">
<p>
match pattern &#x901A;&#x8FC7; tag &#x6765;&#x8BC6;&#x522B;&#x8981;&#x5904;&#x7406;&#x7684;&#x6570;&#x636E;&#xFF0C;match tag &#x4F1A;&#x5339;&#x914D; <b>source</b>  &#x4E2D; <i>tag</i>  &#x5B57;&#x6BB5;&#x6765;&#x786E;&#x5B9A;&#x8981;&#x5904;&#x7406;&#x7684;&#x6570;&#x636E; 
</p>
</div>
</li>
<li><a id="sec-2-1-2-2" name="sec-2-1-2-2"></a><b>@type</b> &#x8BBE;&#x7F6E;&#x8F93;&#x51FA;&#x6E90;&#x4F7F;&#x7528;&#x7684; plugin<br><div class="outline-text-5" id="text-2-1-2-2">
<p>
output plugin <b>@type</b> &#x652F;&#x6301; <i>file</i> &#x548C; <i>forward</i>  &#x7B49;. <i>file</i> &#x5C06;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x4E2D;, <i>forward</i> &#x540C;&#x4E0A;&#x5C06;&#x6570;&#x636E;&#x53D1;&#x9001;&#x5230; TCP &#x534F;&#x8BAE;. 
</p>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;source&gt;
  @type http
  port 9880
  tag myapp.access
&lt;/source&gt;

# Match events tagged with &quot;myapp.access&quot; and
# store them to /var/log/fluent/access.%Y-%m-%d
# Of course, you can control how you partition your data
# with the time_slice_format option.
&lt;match myapp.access&gt;
  @type file
  path /var/log/fluent/access
&lt;/match&gt;</span><br></pre></td></tr></table></figure>
</div>
</div>
</li>
<li><a id="sec-2-1-2-3" name="sec-2-1-2-3"></a>LogService output plugin<br><div class="outline-text-5" id="text-2-1-2-3">
<p>
Fluentd &#x53D1;&#x9001;&#x6570;&#x636E;&#x5230; LogService &#x4F7F;&#x7528;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x7684; plugin: ksy, &#x5177;&#x4F53;&#x914D;&#x7F6E;&#x89C1;&#x4E0B;:
</p>
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;match test&gt; #&#x5339;&#x914D;test
  @type ksy  #&#x5339;&#x914D;&#x8F93;&#x51FA;&#x7C7B;&#x578B; &#x8FD9;&#x91CC;&#x662F;&#x5F00;&#x53D1;&#x7684;&#x4E00;&#x4E2A;&#x8F93;&#x51FA;&#x63D2;&#x4EF6;
  log_service_addr http://10.111.0.41:28888 #&#x5730;&#x5740;
  access_key_id  #ak
  access_key_secret #sk
  Logstore #&#x65E5;&#x5FD7;&#x5E93;
  path /path/to/cache  #&#x7F13;&#x5B58;&#x8DEF;&#x5F84;
&lt;/match&gt;</span><br></pre></td></tr></table></figure>
</div>
</div>
</li></ul>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">&#x542F;&#x505C; Fluentd</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">&#x542F;&#x52A8; Fluentd</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">cd /opt/td-agent &amp;&amp; sh start_fluentd.sh</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">&#x505C;&#x6B62; Fluentd</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">cd /opt/td-agent &amp;&amp; sh stop_fluentd.sh</span><br></pre></td></tr></table></figure>
</div>
<p>
&#x542F;&#x52A8;&#x540E;&#xFF0C;Fluentd &#x65E5;&#x5FD7;&#x5C06;&#x4F1A;&#x5199;&#x5165; /var/log/fluentd/fluentd.log (&#x542F;&#x52A8;&#x65F6;&#x8BF7;&#x4F7F;&#x7528; root &#x6743;&#x9650;)
</p>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">&#x5B98;&#x65B9;&#x6587;&#x6863;</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">Fluentd : <a href="http://www.fluentd.org/" target="_blank" rel="external">Fluentd</a></h3>
</div>
<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2">Fluentd &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8BF4;&#x660E;&#x8BF7;&#x53C2;&#x89C1;: <a href="http://docs.fluentd.org/articles/config-file" target="_blank" rel="external">Fluentd Configure</a></h3>
</div>
</div>

<p class="date">Date: <span class="timestamp-wrapper"><span class="timestamp">&lt;2016-09-08 20:12&gt;</span></span></p>
<p class="author">Author: levin</p>
<p class="date">Created: 2017-01-02 Mon 01:42</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/" target="_blank" rel="external">Emacs</a> 25.1.1 (<a href="http://orgmode.org" target="_blank" rel="external">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer" target="_blank" rel="external">Validate</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/09/learning-design-pattern/" class="prev">PREV</a><a href="/2016/09/use-org-mode-for-GTD/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'levinlee';
var disqus_identifier = '2016/09/fluentd_install/';
var disqus_title = 'LogService Fluentd 部署文档';
var disqus_url = 'http://levincode.com/2016/09/fluentd_install/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//levinlee.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 - 2017 <a href="http://levincode.com">Levin Lee</a>, unless otherwise noted.</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-85531845-1",'auto');ga('send','pageview');</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>